# .github/workflows/check.yml
name: PKGBUILD Check
on: [push, pull_request]

jobs:
  verify:
    runs-on: ubuntu-latest
    container: archlinux:latest 
    steps:
    - uses: actions/checkout@v4
    
    - name: Run pacman toolchain
      run: |
        pacman -Syu --noconfirm
        pacman -S --noconfirm base-devel devtools pacman-contrib git make
    
    - name: Update checksums
      run: |
        find . -name PKGBUILD -execdir updpkgsums \; || true
    
    - name: Verify sources
      run: |
        find . -name PKGBUILD -execdir makepkg --verifysource --nobuild \; || (echo "Verification Failed"; exit 1)
    
    - name: Generate SRCINFO
      run: |
        find . -name PKGBUILD -execdir makepkg --printsrcinfo > .SRCINFO \;
    
    - name: Check Makefile
      run: |
        make test-all || make verify || true  
    
    - name: Summary Overview
      run: |
        echo "âœ“ All PKGBUILDs verified successfully!"
        find . -name .SRCINFO -exec head -5 {} \;
